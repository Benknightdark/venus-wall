<p-toast></p-toast>

<div class="overflow-auto" style="height:100vh">
<p-table [value]="(itemList$|async)||[]" styleClass="p-datatable-gridlines" [scrollable]="true" scrollHeight="800px" >
  <ng-template pTemplate="header">
    <tr>
      <th style="width: 5rem"></th>
      <th>論壇</th>
      <th>建立時間</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-item>
    <tr>
      <td style="width: 5rem">
        <button type="button" pButton pRipple class="p-button-text p-button-rounded p-button-plain"
          [icon]="item.Expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" (click)="onGetDetail(item)"></button>
      </td>
      <td>{{item.Name}}</td>
      <td>{{item.CreatedTime| date:'YYYY/MM/dd HH:mm:ss'}}</td>
    </tr>
    <tr *ngIf="item.Expanded">
      <td colspan="3">
        <div class="p-p-3">
          <p-table [value]="(webPageList$|async)![item!.ID!.toUpperCase()]||[]" styleClass="p-datatable-gridlines">
            <ng-template pTemplate="header">
    <tr>
      <th style="width: 8rem">
      </th>
      <th>看板</th>
      <th>看板連結</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-webPage>
    <tr>
      <td>
        <span class="p-buttonset">
          <a [routerLink]="['/admin/item',webPage.ID]" pButton pRipple class="p-button-rounded p-button-plain"
            icon="pi pi-search"></a>
          <button pButton type="button" class="p-button-rounded p-button-success" icon="pi pi-cloud-download"
            (click)="onOpenExecuteCrawlerModal(webPage)"></button>
        </span>

      </td>
      <td>{{webPage.Name}}</td>
      <td><a [href]="webPage.Url" pButton pRipple class="p-button-help" target='_blank'>開啟連結</a></td>
    </tr>
  </ng-template>
</p-table>
</div>
</td>
</tr>
</ng-template>
</p-table>
</div>

<p-dialog [header]="selectedWebPage.Name!" [(visible)]="display" [breakpoints]="{'960px': '75vw'}"
  [style]="{width: '50vw'}" [draggable]="false" [resizable]="false" [maximizable]='true'>
  <form (ngSubmit)="onSubmit()" #heroForm="ngForm">

    <div class="p-grid p-fluid">
      <div class="p-grid p-fluid">
        <div class="p-field p-col-12 p-md-3">
          <label for="startPage">開始頁數</label>
          <p-inputNumber #startPage [showButtons]="true" buttonLayout="horizontal" inputId="startPage" name="startPage"
            [(ngModel)]="startPageNumber" spinnerMode="horizontal" [step]="1"
            [inputStyleClass]="startPage.value<0?'ng-invalid ng-dirty':''" [required]='true'
            decrementButtonClass="p-button-danger" incrementButtonClass="p-button-success"
            incrementButtonIcon="pi pi-plus" decrementButtonIcon="pi pi-minus" minlength="0">
          </p-inputNumber>
          <div *ngIf="startPageNumber<0" class="alert alert-danger">
            數值需大於等於0
          </div>
        </div>
        <div class="p-field p-col-12 p-md-3">
          <label for="endPage">結束頁數</label>
          <p-inputNumber [(ngModel)]="endPageNumber" #endPage [showButtons]="true" buttonLayout="horizontal"
            inputId="endPage" spinnerMode="horizontal" name="endPage"
            [inputStyleClass]="endPage.value<0?'ng-invalid ng-dirty':''" [required]='true' [step]="1"
            decrementButtonClass="p-button-danger" incrementButtonClass="p-button-success"
            incrementButtonIcon="pi pi-plus" decrementButtonIcon="pi pi-minus" minlength="0">
          </p-inputNumber>
          <div *ngIf="endPageNumber<0" class="alert alert-danger">
            數值需大於等於0
          </div>
        </div>
        <div class="p-field p-col-12 p-md-3">
          <p-button [disabled]="!heroForm.form.valid" type="submit" label="執行爬蟲工作" styleClass="p-button-text">
          </p-button>
        </div>
      </div>
    </div>
  </form>
</p-dialog>
